<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>WasserzÃ¤hler Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="icon-192.png">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ’§ WasserzÃ¤hler Tracker</h1>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Auto-Capture Section -->
            <section id="auto-capture-section" class="section active">
                <h2>Automatische Erfassung</h2>
                
                <!-- Status Display -->
                <div class="status-display">
                    <div class="status-item">
                        <span class="status-label">Status:</span>
                        <span id="auto-status" class="status-value status-inactive">Inaktiv</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Letzter ZÃ¤hlerstand:</span>
                        <span id="last-reading" class="status-value">---</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">NÃ¤chste Erfassung:</span>
                        <span id="next-capture" class="status-value">---</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Erfolgreich:</span>
                        <span id="success-count" class="status-value">0</span>
                    </div>
                </div>

                <!-- Camera Preview -->
                <div class="camera-container">
                    <video id="camera-preview" autoplay playsinline muted></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                    <div id="capture-indicator" class="capture-indicator"></div>
                </div>

                <!-- Auto-Capture Controls -->
                <div class="auto-controls">
                    <div class="interval-selector">
                        <label for="capture-interval">Erfassungsintervall:</label>
                        <select id="capture-interval">
                            <option value="5">5 Minuten (Test)</option>
                            <option value="15">15 Minuten</option>
                            <option value="30">30 Minuten</option>
                            <option value="60" selected>1 Stunde</option>
                            <option value="120">2 Stunden</option>
                            <option value="360">6 Stunden</option>
                        </select>
                    </div>
                    
                    <button id="start-auto-btn" class="btn btn-primary btn-large">
                        ğŸ”„ Automatik starten
                    </button>
                    <button id="stop-auto-btn" class="btn btn-danger btn-large" style="display: none;">
                        â¹ Automatik stoppen
                    </button>
                </div>

                <!-- Battery Warning -->
                <div id="battery-warning" class="warning-box" style="display: none;">
                    âš ï¸ Smartphone an Netzteil anschlieÃŸen fÃ¼r Dauerbetrieb!
                </div>
            </section>

            <!-- Manual Entry Section -->
            <section class="section">
                <h2>Manuelle Eingabe</h2>
                <div class="manual-entry">
                    <div class="reading-input">
                        <input type="number" id="manual-reading" step="0.001" placeholder="ZÃ¤hlerstand eingeben">
                        <span class="unit">mÂ³</span>
                    </div>
                    <button id="save-manual-btn" class="btn btn-primary">ğŸ’¾ Speichern</button>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="section">
                <h2>Einstellungen</h2>
                
                <!-- API Configuration -->
                <div class="settings-group">
                    <h3>ğŸ¤– AI Vision API</h3>
                    <div class="api-config">
                        <div class="input-group">
                            <label for="api-key-input">OpenRouter API Key:</label>
                            <input type="password" id="api-key-input" placeholder="sk-or-v1-...">
                            <small>Erhalte deinen API Key auf <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai/keys</a></small>
                        </div>
                        <div class="input-group">
                            <label for="model-select">Modell:</label>
                            <select id="model-select">
                                <option value="openai/gpt-4o">OpenAI GPT-4o (~$0.01/Bild)</option>
                                <option value="openai/gpt-4o-mini">OpenAI GPT-4o Mini (~$0.001/Bild)</option>
                                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet (~$0.008/Bild)</option>
                                <option value="google/gemini-2.0-flash-exp">Gemini 2.0 Flash (~$0.001/Bild)</option>
                            </select>
                        </div>
                        <button id="save-api-config-btn" class="btn btn-primary">ğŸ’¾ API-Konfiguration speichern</button>
                    </div>
                </div>

                <!-- App Settings -->
                <div class="settings-group">
                    <h3>ğŸ“± App-Einstellungen</h3>
                    <label class="setting-item">
                        <input type="checkbox" id="keep-screen-on" checked>
                        <span>Display immer eingeschaltet lassen (Wake Lock)</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="sound-enabled">
                        <span>Ton bei Erfassung aktivieren</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="flash-indicator" checked>
                        <span>Visueller Indikator bei Erfassung</span>
                    </label>
                </div>
                <div class="settings-info">
                    <p>ğŸ’¡ <strong>Tipp:</strong> Smartphone an Netzteil anschlieÃŸen und Display-Timeout in den Systemeinstellungen deaktivieren.</p>
                </div>
            </section>

            <!-- Visualization Section -->
            <section class="section">
                <h2>Wasserverbrauch</h2>
                <div class="chart-controls">
                    <select id="chart-type">
                        <option value="daily">Heute (Std.)</option>
                        <option value="weekly">Woche (Tage)</option>
                        <option value="hourly-week">Woche (Std./Tag)</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="usage-chart"></canvas>
                </div>
            </section>

            <!-- Pump Recommendation Section -->
            <section class="section pump-section">
                <h2>ğŸ”§ Pumpen-Empfehlung</h2>
                
                <div class="pump-config">
                    <div class="coverage-slider">
                        <label for="coverage-percentage">Abdeckungsgrad:</label>
                        <div class="slider-container">
                            <input type="range" id="coverage-percentage" min="50" max="100" value="80" step="5">
                            <span id="coverage-value" class="coverage-display">80%</span>
                        </div>
                        <p class="slider-description">
                            Die Pumpe soll <strong id="coverage-text">80%</strong> der Wasserentnahme-ZeitrÃ¤ume abdecken.
                        </p>
                    </div>
                    
                    <button id="calculate-pump-btn" class="btn btn-primary btn-large">
                        ğŸ”„ Empfehlung berechnen
                    </button>
                </div>

                <div id="pump-recommendation" class="pump-recommendation" style="display: none;">
                    <h3>ğŸ“… Empfohlene Laufzeiten</h3>
                    <div id="pump-schedule" class="pump-schedule"></div>
                    
                    <div class="pump-stats">
                        <div class="stat-item">
                            <span class="stat-label">Aktive Stunden/Tag:</span>
                            <span id="active-hours" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Abgedeckter Verbrauch:</span>
                            <span id="covered-usage" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Energieeinsparung:</span>
                            <span id="energy-savings" class="stat-value stat-success">-</span>
                        </div>
                    </div>

                    <div class="export-buttons">
                        <button id="export-text-btn" class="btn btn-secondary">
                            ğŸ“„ Als Text exportieren
                        </button>
                        <button id="export-ical-btn" class="btn btn-secondary">
                            ğŸ“… Als iCal exportieren
                        </button>
                    </div>
                </div>

                <div id="pump-info" class="info-box">
                    <p><strong>â„¹ï¸ Hinweis:</strong> Sammle mindestens 2 Wochen Daten fÃ¼r eine prÃ¤zise Empfehlung. Ideal sind 4-8 Wochen fÃ¼r saisonale Muster.</p>
                </div>
            </section>

            <!-- Readings History -->
            <section class="section">
                <h2>ZÃ¤hlerstandsverlauf</h2>
                <div id="readings-list" class="readings-list"></div>
            </section>
        </main>

        <!-- Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-section="auto">
                ğŸ”„<br>Auto
            </button>
            <button class="nav-btn" data-section="chart">
                ğŸ“Š<br>Analyse
            </button>
            <button class="nav-btn" data-section="history">
                ğŸ“‹<br>Verlauf
            </button>
            <button class="nav-btn" data-section="settings">
                âš™ï¸<br>Einstellungen
            </button>
        </nav>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Verarbeite Bild...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
